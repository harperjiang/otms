<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sign Up</title>
<!--#include virtual="head.html" -->
<script type="text/javascript" src="scripts/validator.js"></script>
<script type='text/javascript' src='dwr/interface/ProfileService.js'></script>
<script>
	$(function() {
		// Load timezone data
		otms.loadTzSelect($('#timezone_select'));

		// Setup Validator
		new otms.validator.NonemptyValidator($('#name_input'));
		new otms.validator.NonemptyValidator($('#display_input'));
		new otms.validator.EmailValidator($('#email_input'));
		new otms.validator.PasswordValidator($('#password_input'));

		window.beanManager = new otms.validator.BeanManager();
		var bm = window.beanManager;
		bm.reg('username', $('#name_input'));
		bm.reg('displayName', $('#display_input'));
		bm.reg('email', $('#email_input'));
		bm.reg('password', $('#password_input'));
		bm.reg('timezone', $('#timezone_select'));
		bm.reg('type', $('input[name="role"]'));
		bm.reg('agree', $('#agree_checkbox'));
		bm.validate = function(bean, vresult) {
			if (!bean.agree) {
				this.fail([ 'agree' ], 'Please accept the agreement');
				otms.ui.MessageBox.warning($('#errmsg_panel'),
						'Please accept the agreement');
				return false;
			}
			return true;
		};

		var callback = function(success) {
			if (success) {
				// Switch to confirm page
				$('#signup_info_panel').css('display', 'none');
				$('#email_span').append($('#email_input').val());
				$('#signup_confirm_panel').css('display', "block");
			} else {
				$('#signup_btn').removeAttr('disabled');
			}
		};

		$('#signup_btn').click(
				function(event) {
					$(this).attr('disabled', 'true');
					var bean = window.beanManager.getBean();
					if (bean != null) {
						ProfileService.registerUser(otms.auth.req(bean),
								otms.ui.MessageBox.han(callback));
					} else {
						$(this).removeAttr('disabled');
					}
				});
		$('#switch_btn').click(function(event) {
			$('#signup_info_panel').css('display', 'none');
			$('#email_span').append($('#email_input').val());
			$('#signup_confirm_panel').css('display', "block");
		});
	});
</script>
</head>
<body>
	<div id="page">
		<!--#include virtual="header.html" -->
		<div id='errmsg_panel'></div>
		<div id="page_content_thin" class="form">
			<div class="form_title">Sign Up</div>
			<input type="text" id="name_input" placeholder="Username" /> <input
				type="text" id="display_input" placeholder="Display Name" /><input
				type="text" id="email_input" placeholder="Email Address" /> <input
				id="password_input" type="password"
				placeholder="Password (length > 8, with letter, number and symbol)" />
			<div class="form_row">
				<label style="margin-bottom: 10px">Local TimeZone:</label><select
					id="timezone_select"></select>
			</div>
			<div class="form_row">
				<div>
					<label style='width: 80px'>I am </label> <label><input
						type="radio" name="role" value="client" checked /> looking for a
						tutor</label>
				</div>
				<div>
					<label style='width: 80px'>&nbsp;</label> <label><input
						type="radio" name="role" value="tutor"> willing to teach
						students</label>
				</div>

			</div>
			<div class="form_row">
				<input name="agree" id="agree_checkbox" type="checkbox"
					style="display: inline-block; width: 30px" /><label
					style="width: 350px" for="agree_checkbox">I accept to the
					terms and user agreements</label>
			</div>
			<div>
				<button id="signup_btn" class="btn_large">Sign Up</button>
				<button id="switch_btn" style="display: none" class="btn_large">Switch</button>
			</div>
		</div>
		<div id="signup_confirm_panel" class="form centerpanel"
			style="display: none;">
			<div class="form_title">Success!</div>
			<div class="form_row">
				We have sent an email to <span id="email_span"
					style="font-weight: bold"></span>. Please follow the instruction to
				complete registration.
			</div>
			<div class="form_row">Didn't see the email? Check if it is in
				your spam folder.</div>
			<div class="form_row">
				Here's some introductions you can start with.
				<div class="form_section">For students:</div>
				<div>
					<a href="">How can I find a good tutor?</a>
				</div>
				<div>
					<a href="">How can I find a good tutor?</a>
				</div>
				<div class="form_section">For tutors:</div>
				<div>
					<a href="">How can I find a good tutor?</a>
				</div>
				<div>
					<a href="">How can I find a good tutor?</a>
				</div>
			</div>
		</div>
	</div>

	<!--#include virtual="footer.html" -->
</body>
</html>