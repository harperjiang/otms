<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Setup Lesson</title>
<link rel="stylesheet" type="text/css" href="styles/all.css" />
<link href="styles/jquery-ui.css" rel="stylesheet">
<script type="text/javascript" src="scripts/jquery-2.1.4.js"></script>
<script src="scripts/jquery-ui.js"></script>
<script type="text/javascript" src="scripts/ui.js"></script>
<script type="text/javascript" src="scripts/errmsg.js"></script>
<script type="text/javascript" src="scripts/ui/msgbox.js"></script>
<script type="text/javascript" src="scripts/validator.js"></script>
<script type="text/javascript" src="scripts/auth.js"></script>
<script type='text/javascript' src='dwr/engine.js'></script>
<script type='text/javascript' src='dwr/interface/LessonService.js'></script>
<script>
	function snapshot_mode() {
		otms.lessonItemPage.snapshotMode = true;
		$('#title_panel').empty();
		$('#title_panel').append('View Snapshot');
		$('#title_input').prop('readonly', 'true');
		$('#desc_text').prop('readonly', 'true');
		$('#timefrom_input').prop('readonly', 'true');
		$('#timeto_input').prop('readonly', 'true');
		$('#date_input').prop('readonly', 'true');
		$('#delete_btn').css('display', 'none');
	};

	$(function() {
		// Initialize to lesson_item mode
		otms.namespace('otms.lessonItemPage');
		otms.lessonItemPage.snapshotMode = false;

		// Install validator
		new otms.validator.TimeValidator($('#timefrom_input'));
		new otms.validator.TimeValidator($('#timeto_input'));
		new otms.validator.DateValidator($('#date_input'));

		// Install BeanManager
		var bm = new otms.validator.BeanManager();
		bm.reg('title', $('#title_input'));
		bm.reg('tutorName', $('#tutor_input'));
		bm.reg('description', $('#desc_text'));
		bm.reg('date', $('#date_input'));
		bm.reg('fromTime', $('#timefrom_input'));
		bm.reg('toTime', $('#timeto_input'));

		bm.validate = function(bean, vresult) {
			return true;
		};
		debugger;
		otms.lessonItemPage.bm = bm;

		// Check storage for input parameter
		var eventId = sessionStorage.getItem('lessonItem.id');
		var eventType = sessionStorage.getItem('lessonItem.type');

		sessionStorage.removeItem("lessonItem.id");
		sessionStorage.removeItem("lessonItem.type");
	
		if (eventId != undefined) {
			// Load data from server
			switch (eventType) {
			case 'lesson_item':
				var req = otms.auth.req({
					'lessonItemId' : eventId
				});
				var callback = function(success, data) {
					if (success) {
						bm.setBean(data.lessonItem);
					}
				};
				LessonService.getLessonItem(req, otms.ui.MessageBox.errhandler(
						$('#errmsg_panel'), callback));

				break;
			case 'snapshot':
				snapshot_mode();
				var req = otms.auth.req({
					'snapshotId' : eventId
				});
				var callback = function(success, data) {
					if (success) {
						bm.setBean(data.snapshot);
					}
				};
				LessonService.getSnapshot(req, otms.ui.MessageBox.errhandler(
						$('#errmsg_panel'), callback));
				break;
			default:
				break;
			}
			$('#confirm_btn').removeAttr('disabled');
			$('#delete_btn').removeAttr('disabled');
		} else {
			// Display warning
			otms.ui.MessageBox.warning($('#errmsg_panel'),
					'Invalid access. Will now go to front page');
			setTimeout(function() {
				window.location = 'index.html';
			}, 4000);
		}

		$('#confirm_btn').click(function(event) {

		});

		$('#delete_btn').click(function(event) {

		});
	});
</script>
</head>
<body>
	<!--#include virtual="header.html" -->
	<div class="form centerpanel">
		<div id='errmsg_panel'></div>
		<div id="title_panel" class='form_title'>Modify Lesson Item</div>
		<div class="form_section">Lesson Information</div>
		<input type="text" id='title_input' placeholder="Lesson Title"><input
			type="text" id='tutor_input' placeholder="Your tutor id" disabled>
		<textarea id="desc_text" placeholder="Lesson Description"></textarea>
		<div class="form_section">Lesson Time (your local time)</div>
		<div class='form_row'>
			<div style='display: inline-block; width: 49%'>
				<label class='timelabel2'>From:</label> <input type='text'
					placeholder='08:00' id='timefrom_input' class='timeinput2' />
			</div>
			<div style='display: inline-block; width: 49%'>
				<label class='timelabel2'>To:</label> <input type='text'
					placeholder='09:00' id='timeto_input' class='timeinput2' />
			</div>
		</div>
		<div class='form_row'>
			<label>Meet On:</label> <input type='text' id='date_input'
				placeholder='01/01/2015' class='timeinput' />
		</div>
		<div class="form_row">
			<button id="confirm_btn" class="btn_large" disabled>Confirm</button>
			<button id="delete_btn" class="btn_danger" style='margin-left: 20px;'
				disabled>Delete Lesson Item</button>
		</div>
	</div>
	<!--#include virtual="footer.html" -->
</body>
</html>